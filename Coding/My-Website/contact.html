<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload Practice Stats</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f7f7f7;
    }

    nav {
      background-color: #004d00;
      padding: 10px;
      text-align: center;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin: 0 15px;
      font-weight: bold;
      font-size: 16px;
    }

    nav a:hover {
      text-decoration: underline;
    }

    .container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      color: #004d00;
      margin-top: 0;
    }

    input[type="file"] {
      display: block;
      margin: 20px auto;
    }

    button {
      margin: 10px 5px;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 30px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #004d00;
      color: white;
    }

    .upload-log {
      margin-top: 30px;
      padding: 10px;
      background: #e6ffe6;
      border: 1px solid #a3d9a5;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <nav>
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
<a href="notes-dashboard.html">Notes</a>
  </nav>

  <div class="container">
    <h2>Upload Practice Stats CSV</h2>
    <input type="file" id="csvFile" accept=".csv" />

    <div style="text-align: center;">
      <button onclick="saveToTotals()">‚ûï Save to Season Totals</button>
      <button onclick="viewSeasonTotals()">üìä View Season Totals</button>
      <button onclick="clearSeasonTotals()">üóë Clear Season Totals</button>
    </div>

    <div id="output"></div>
    <div class="upload-log">
      <h3>üìÅ Manage Uploaded Practices</h3>
      <ul id="uploadList"></ul>
    </div>
  </div>

  <script>
    let lastUploadedStats = [];
    let lastUploadId = null;

    document.getElementById('csvFile').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const csv = e.target.result;
        lastUploadId = `${file.name}-${Date.now()}`;
        processCSV(csv, false);
      };
      reader.readAsText(file);
    });

    function formatPercent(val) {
      return isNaN(val) || val === null || val === undefined ? '‚Äî' : `${val}%`;
    }

    function formatRatio(made, att) {
      return att ? `${made}/${att}` : '‚Äî';
    }

    function processCSV(csv, isCombinedView) {
      const rows = csv.split('\n').map(row => row.split(','));
      const players = rows[0];
      const data = rows.slice(1);
      const drillNameIndex = players.findIndex(name => name.trim().toLowerCase() === 'drill name');

      const statTable = players.map((player, i) => {
        if (i === drillNameIndex) return null;
        const col = [];

        data.forEach(row => {
          const drill = row[drillNameIndex]?.trim();
          const value = row[i] ? row[i].trim() : null;
          if (drill !== '' && value) col.push(value);
        });

        return player ? { player, stats: col } : null;
      }).filter(Boolean);

      const result = statTable.map(p => {
        const counts = {};
        p.stats.forEach(s => {
          const parts = s.split(',').map(part =>
            part.replace(/['"]/g, '').trim().toUpperCase()
          );
          parts.forEach(part => {
            if (part !== '') {
              if (part.includes('ATR+')) counts['ATR+'] = (counts['ATR+'] || 0) + 1;
              else if (part.includes('ATR-')) counts['ATR-'] = (counts['ATR-'] || 0) + 1;
              else if (part.includes('2FG+')) counts['2FG+'] = (counts['2FG+'] || 0) + 1;
              else if (part.includes('2FG-')) counts['2FG-'] = (counts['2FG-'] || 0) + 1;
              else if (part.includes('3FG+')) counts['3FG+'] = (counts['3FG+'] || 0) + 1;
              else if (part.includes('3FG-')) counts['3FG-'] = (counts['3FG-'] || 0) + 1;
              else if (part.includes('FT+')) counts['FT+'] = (counts['FT+'] || 0) + 1;
              else if (part.includes('FT-')) counts['FT-'] = (counts['FT-'] || 0) + 1;
              else if (part === 'ASSIST') counts['Assist'] = (counts['Assist'] || 0) + 1;
              else if (part === 'POT. ASSIST') counts['Pot. Assist'] = (counts['Pot. Assist'] || 0) + 1;
              else if (part.includes('DREB')) counts['DREB'] = (counts['DREB'] || 0) + 1;
              else if (part.includes('OREB')) counts['OREB'] = (counts['OREB'] || 0) + 1;
              else if (part.includes('TURNOVER')) counts['Turnover'] = (counts['Turnover'] || 0) + 1;
            }
          });
        });

        const atrPlus = counts['ATR+'] || 0;
        const atrMinus = counts['ATR-'] || 0;
        const fg2Plus = counts['2FG+'] || 0;
        const fg2Minus = counts['2FG-'] || 0;
        const fg3Plus = counts['3FG+'] || 0;
        const fg3Minus = counts['3FG-'] || 0;
        const ftPlus = counts['FT+'] || 0;
        const ftMinus = counts['FT-'] || 0;
        const assists = counts['Assist'] || 0;
        const potAssists = counts['Pot. Assist'] || 0;
        const dreb = counts['DREB'] || 0;
        const oreb = counts['OREB'] || 0;
        const turnover = counts['Turnover'] || 0;

        const points = atrPlus * 2 + fg2Plus * 2 + fg3Plus * 3 + ftPlus;
        const rebounds = dreb + oreb;

        const atrAtt = atrPlus + atrMinus;
        const fg2Att = fg2Plus + fg2Minus;
        const fg3Att = fg3Plus + fg3Minus;
        const ftAtt = ftPlus + ftMinus;

        const atrPct = atrAtt ? (100 * atrPlus / atrAtt).toFixed(1) : null;
        const fg2Pct = fg2Att ? (100 * fg2Plus / fg2Att).toFixed(1) : null;
        const fg3Pct = fg3Att ? (100 * fg3Plus / fg3Att).toFixed(1) : null;
        const ftPct = ftAtt ? (100 * ftPlus / ftAtt).toFixed(1) : null;

        return {
          player: p.player,
          points, rebounds, assists, potAssists, turnover,
          atrPct, atrRatio: formatRatio(atrPlus, atrAtt),
          fg2Pct, fg2Ratio: formatRatio(fg2Plus, fg2Att),
          fg3Pct, fg3Ratio: formatRatio(fg3Plus, fg3Att),
          ftPct, ftRatio: formatRatio(ftPlus, ftAtt)
        };
      });

      if (!isCombinedView) {
        lastUploadedStats = result;
      }

      renderTable(result, isCombinedView ? 'Season Totals' : 'Practice Stats');
    }

    function renderTable(data, title = '') {
      const output = document.getElementById('output');
      let html = `<h3>${title}</h3>`;
      html += `
      <table><tr>
        <th>Player</th>
        <th>Points</th>
        <th>Rebounds</th>
        <th>Assists</th>
        <th>Pot. Assists</th>
        <th>Turnovers</th>
        <th>ATR%</th><th>ATR (M/A)</th>
        <th>2FG%</th><th>2FG (M/A)</th>
        <th>3FG%</th><th>3FG (M/A)</th>
        <th>FT%</th><th>FT (M/A)</th>
      </tr>`;

      data.forEach(row => {
        html += `<tr>
          <td>${row.player}</td>
          <td>${row.points}</td>
          <td>${row.rebounds}</td>
          <td>${row.assists}</td>
          <td>${row.potAssists}</td>
          <td>${row.turnover}</td>
          <td>${formatPercent(row.atrPct)}</td><td>${row.atrRatio}</td>
          <td>${formatPercent(row.fg2Pct)}</td><td>${row.fg2Ratio}</td>
          <td>${formatPercent(row.fg3Pct)}</td><td>${row.fg3Ratio}</td>
          <td>${formatPercent(row.ftPct)}</td><td>${row.ftRatio}</td>
        </tr>`;
      });

      html += '</table>';
      output.innerHTML = html;
    }

    function saveToTotals() {
      let allUploads = JSON.parse(localStorage.getItem('allUploads') || '[]');
      allUploads.push({ id: lastUploadId, data: lastUploadedStats });
      localStorage.setItem('allUploads', JSON.stringify(allUploads));
      alert("Saved to season totals!");
      updateUploadList();
    }

    function viewSeasonTotals() {
      const uploads = JSON.parse(localStorage.getItem('allUploads') || '[]');
      const totals = {};
      uploads.forEach(upload => {
        upload.data.forEach(stat => {
          if (!totals[stat.player]) {
            totals[stat.player] = { ...stat };
          } else {
            const p = totals[stat.player];
            p.points += stat.points;
            p.rebounds += stat.rebounds;
            p.assists += stat.assists;
            p.potAssists += stat.potAssists;
            p.turnover += stat.turnover;
          }
        });
      });
      renderTable(Object.values(totals), 'Season Totals');
    }

    function clearSeasonTotals() {
      localStorage.removeItem('allUploads');
      alert("Season totals cleared.");
      document.getElementById('output').innerHTML = '';
      updateUploadList();
    }

    function deleteUpload(id) {
      let uploads = JSON.parse(localStorage.getItem('allUploads') || '[]');
      uploads = uploads.filter(u => u.id !== id);
      localStorage.setItem('allUploads', JSON.stringify(uploads));
      updateUploadList();
      viewSeasonTotals();
    }

    function updateUploadList() {
      const uploads = JSON.parse(localStorage.getItem('allUploads') || '[]');
      const list = document.getElementById('uploadList');
      list.innerHTML = '';
      uploads.forEach(upload => {
        const li = document.createElement('li');
        li.textContent = upload.id;
        const btn = document.createElement('button');
        btn.textContent = 'Delete';
        btn.style.marginLeft = '10px';
        btn.onclick = () => deleteUpload(upload.id);
        li.appendChild(btn);
        list.appendChild(li);
      });
    }

    window.onload = updateUploadList;
  </script>
</body>
</html>



